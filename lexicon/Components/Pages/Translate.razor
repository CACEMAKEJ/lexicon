@page "/"
@using lexicon.Components.Services
@inject DetectLanguageService LanguageDetector
@inject TranslationService Translator 
@rendermode InteractiveServer


<PageTitle>Translate</PageTitle>

<div class="width-limiter container d-flex flex-column justify-content-center mx-auto p-4">
    <h3 class="fs-4 font-bold mb-4 " style="text-align: center; color: rgba(115, 118, 128, 0.3)">/ËˆlÉ›ksáµ»k(É™)n/</h3>
    <h1 class="lexicon-heading font-bold mb-4" style="text-align: center; color: rgba(255, 255, 255, 1)">lexicon</h1>
    
    <div class="translatorTextField pt-5">
        <input @bind="inputText" type="text" placeholder="What would you like to translate?" />
        <div class="line"></div>
    </div>

    <div class="py-4">
        <button class="btn btn-primary bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out" 
                @onclick="DetectAndTranslate">
            Detect and Translate
        </button>
    </div>
  
    @if (!string.IsNullOrEmpty(detectionResult) || !string.IsNullOrEmpty(translationResult))
    {
        <div class="mt-5 p-4" style="background-color:#2f3542; border-radius:14px; border:1px solid #3f4654; color:white; box-shadow:0 4px 14px rgba(0,0,0,0.4);">
            <div class="mb-3 text-white font-semibold">
                @detectionResult
            </div>

            <label class="text-sm text-gray-400">Translation</label>
            <textarea
            class="w-100 p-3 bg-gray-800 text-black border border-gray-600 rounded-lg"
            rows="3"
            readonly>@translationResult</textarea>
        </div>
    }
    <div class="mt-5 p-4" style="background-color:#2f3542; border-radius:14px; border:1px solid #3f4654; color:white; box-shadow:0 4px 14px rgba(0,0,0,0.4);">
        <p class="mb-2 fs-5">ðŸ’¬ Curious?</p>
        <p class="mb-3">
            Want to see what other people are translating around the world?
            Explore the global translation feed!
        </p>
        <a href="/global" class="btn btn-light text-blue-700 fw-bold px-4">View History</a>
    </div>
</div>

@code {
    private string? inputText;
    private string? detectionResult;  
    private string? translationResult; 
    
    private async Task DetectAndTranslate()
    {
        if (string.IsNullOrWhiteSpace(inputText))
        {
            detectionResult = "Please enter text to translate.";
            translationResult = "";
            StateHasChanged();
            return;
        }

        detectionResult = "Detecting...";
        translationResult = "";
        StateHasChanged(); 

        string languageCode = await LanguageDetector.DetectLanguageAsync(inputText);

        if (string.IsNullOrEmpty(languageCode)) {
            detectionResult = "Could not detect language. (Check DL_KEY and server console for errors.)";
            translationResult = "";
            StateHasChanged();
            return;
        }
        
        detectionResult = $"Detected language: {languageCode}";

        if (languageCode == "en") {
            translationResult = "Text is already in English.";
        }
        else {
            translationResult = "Translating...";
            StateHasChanged(); 
            string translatedText = await Translator.TranslateAsync(inputText, languageCode, "en");

            translationResult = translatedText;
        }
        
        StateHasChanged();
    }
}
